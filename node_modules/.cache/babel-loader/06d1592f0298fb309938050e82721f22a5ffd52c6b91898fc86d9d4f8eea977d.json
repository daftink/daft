{"ast":null,"code":"import _objectSpread from \"/tmp/daft-chat-temp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport throttle from 'lodash.throttle';\nimport React, { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport clsx from 'clsx';\nimport { resampleWaveformData } from '../audioSampling';\nexport const WaveProgressBar = _ref => {\n  let {\n    amplitudesCount = 40,\n    progress = 0,\n    relativeAmplitudeBarWidth = 2,\n    relativeAmplitudeGap = 1,\n    seek,\n    waveformData\n  } = _ref;\n  const [progressIndicator, setProgressIndicator] = useState(null);\n  const isDragging = useRef(false);\n  const [root, setRoot] = useState(null);\n  const [trackAxisX, setTrackAxisX] = useState();\n  const lastRootWidth = useRef(undefined);\n  const handleDragStart = e => {\n    e.preventDefault();\n    if (!progressIndicator) return;\n    isDragging.current = true;\n    progressIndicator.style.cursor = 'grabbing';\n  };\n  const handleDrag = e => {\n    if (!isDragging.current) return;\n    // Due to throttling of seek, it is necessary to create a copy (snapshot) of the event.\n    // Otherwise, the event would be nullified at the point when the throttled function is executed.\n    seek(_objectSpread({}, e));\n  };\n  const handleDragStop = useCallback(() => {\n    if (!progressIndicator) return;\n    isDragging.current = false;\n    progressIndicator.style.removeProperty('cursor');\n  }, [progressIndicator]);\n  const getTrackAxisX = useMemo(() => throttle(rootWidth => {\n    if (rootWidth === lastRootWidth.current) return;\n    lastRootWidth.current = rootWidth;\n    const possibleAmpCount = Math.floor(rootWidth / (relativeAmplitudeGap + relativeAmplitudeBarWidth));\n    const tooManyAmplitudesToRender = possibleAmpCount < amplitudesCount;\n    const barCount = tooManyAmplitudesToRender ? possibleAmpCount : amplitudesCount;\n    const amplitudeBarWidthToGapRatio = relativeAmplitudeBarWidth / (relativeAmplitudeBarWidth + relativeAmplitudeGap);\n    const barWidth = barCount && rootWidth / barCount * amplitudeBarWidthToGapRatio;\n    setTrackAxisX({\n      barCount,\n      barWidth,\n      gap: barWidth * (relativeAmplitudeGap / relativeAmplitudeBarWidth)\n    });\n  }, 1), [relativeAmplitudeBarWidth, relativeAmplitudeGap, amplitudesCount]);\n  const resampledWaveformData = useMemo(() => trackAxisX ? resampleWaveformData(waveformData, trackAxisX.barCount) : [], [trackAxisX, waveformData]);\n  useEffect(() => {\n    document.addEventListener('pointerup', handleDragStop);\n    return () => {\n      document.removeEventListener('pointerup', handleDragStop);\n    };\n  }, [handleDragStop]);\n  useEffect(() => {\n    if (!root || typeof ResizeObserver === 'undefined') return;\n    const observer = new ResizeObserver(_ref2 => {\n      let [entry] = _ref2;\n      getTrackAxisX(entry.contentRect.width);\n    });\n    observer.observe(root);\n    return () => {\n      observer.disconnect();\n    };\n  }, [getTrackAxisX, root]);\n  useLayoutEffect(() => {\n    if (!root) return;\n    const {\n      width: rootWidth\n    } = root.getBoundingClientRect();\n    getTrackAxisX(rootWidth);\n  }, [getTrackAxisX, root]);\n  if (!waveformData.length || (trackAxisX === null || trackAxisX === void 0 ? void 0 : trackAxisX.barCount) === 0) return null;\n  return React.createElement(\"div\", {\n    className: 'str-chat__wave-progress-bar__track',\n    \"data-testid\": 'wave-progress-bar-track',\n    onClick: seek,\n    onPointerDown: handleDragStart,\n    onPointerMove: handleDrag,\n    onPointerUp: handleDragStop,\n    ref: setRoot,\n    role: 'progressbar',\n    style: {\n      '--str-chat__voice-recording-amplitude-bar-gap-width': (trackAxisX === null || trackAxisX === void 0 ? void 0 : trackAxisX.gap) + 'px'\n    }\n  }, resampledWaveformData.map((amplitude, i) => React.createElement(\"div\", {\n    className: clsx('str-chat__wave-progress-bar__amplitude-bar', {\n      ['str-chat__wave-progress-bar__amplitude-bar--active']: progress > i / resampledWaveformData.length * 100\n    }),\n    \"data-testid\": 'amplitude-bar',\n    key: \"amplitude-\".concat(i),\n    style: {\n      '--str-chat__voice-recording-amplitude-bar-width': (trackAxisX === null || trackAxisX === void 0 ? void 0 : trackAxisX.barWidth) + 'px',\n      '--str-chat__wave-progress-bar__amplitude-bar-height': amplitude ? amplitude * 100 + '%' : '0%'\n    }\n  })), React.createElement(\"div\", {\n    className: 'str-chat__wave-progress-bar__progress-indicator',\n    \"data-testid\": 'wave-progress-bar-progress-indicator',\n    ref: setProgressIndicator,\n    style: {\n      left: \"\".concat(progress < 0 ? 0 : progress > 100 ? 100 : progress, \"%\")\n    }\n  }));\n};","map":{"version":3,"names":["throttle","React","useCallback","useEffect","useLayoutEffect","useMemo","useRef","useState","clsx","resampleWaveformData","WaveProgressBar","_ref","amplitudesCount","progress","relativeAmplitudeBarWidth","relativeAmplitudeGap","seek","waveformData","progressIndicator","setProgressIndicator","isDragging","root","setRoot","trackAxisX","setTrackAxisX","lastRootWidth","undefined","handleDragStart","e","preventDefault","current","style","cursor","handleDrag","_objectSpread","handleDragStop","removeProperty","getTrackAxisX","rootWidth","possibleAmpCount","Math","floor","tooManyAmplitudesToRender","barCount","amplitudeBarWidthToGapRatio","barWidth","gap","resampledWaveformData","document","addEventListener","removeEventListener","ResizeObserver","observer","_ref2","entry","contentRect","width","observe","disconnect","getBoundingClientRect","length","createElement","className","onClick","onPointerDown","onPointerMove","onPointerUp","ref","role","map","amplitude","i","key","concat","left"],"sources":["/tmp/daft-chat-temp/node_modules/stream-chat-react/dist/components/Attachment/components/WaveProgressBar.js"],"sourcesContent":["import throttle from 'lodash.throttle';\nimport React, { useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState, } from 'react';\nimport clsx from 'clsx';\nimport { resampleWaveformData } from '../audioSampling';\nexport const WaveProgressBar = ({ amplitudesCount = 40, progress = 0, relativeAmplitudeBarWidth = 2, relativeAmplitudeGap = 1, seek, waveformData, }) => {\n    const [progressIndicator, setProgressIndicator] = useState(null);\n    const isDragging = useRef(false);\n    const [root, setRoot] = useState(null);\n    const [trackAxisX, setTrackAxisX] = useState();\n    const lastRootWidth = useRef(undefined);\n    const handleDragStart = (e) => {\n        e.preventDefault();\n        if (!progressIndicator)\n            return;\n        isDragging.current = true;\n        progressIndicator.style.cursor = 'grabbing';\n    };\n    const handleDrag = (e) => {\n        if (!isDragging.current)\n            return;\n        // Due to throttling of seek, it is necessary to create a copy (snapshot) of the event.\n        // Otherwise, the event would be nullified at the point when the throttled function is executed.\n        seek({ ...e });\n    };\n    const handleDragStop = useCallback(() => {\n        if (!progressIndicator)\n            return;\n        isDragging.current = false;\n        progressIndicator.style.removeProperty('cursor');\n    }, [progressIndicator]);\n    const getTrackAxisX = useMemo(() => throttle((rootWidth) => {\n        if (rootWidth === lastRootWidth.current)\n            return;\n        lastRootWidth.current = rootWidth;\n        const possibleAmpCount = Math.floor(rootWidth / (relativeAmplitudeGap + relativeAmplitudeBarWidth));\n        const tooManyAmplitudesToRender = possibleAmpCount < amplitudesCount;\n        const barCount = tooManyAmplitudesToRender ? possibleAmpCount : amplitudesCount;\n        const amplitudeBarWidthToGapRatio = relativeAmplitudeBarWidth / (relativeAmplitudeBarWidth + relativeAmplitudeGap);\n        const barWidth = barCount && (rootWidth / barCount) * amplitudeBarWidthToGapRatio;\n        setTrackAxisX({\n            barCount,\n            barWidth,\n            gap: barWidth * (relativeAmplitudeGap / relativeAmplitudeBarWidth),\n        });\n    }, 1), [relativeAmplitudeBarWidth, relativeAmplitudeGap, amplitudesCount]);\n    const resampledWaveformData = useMemo(() => (trackAxisX ? resampleWaveformData(waveformData, trackAxisX.barCount) : []), [trackAxisX, waveformData]);\n    useEffect(() => {\n        document.addEventListener('pointerup', handleDragStop);\n        return () => {\n            document.removeEventListener('pointerup', handleDragStop);\n        };\n    }, [handleDragStop]);\n    useEffect(() => {\n        if (!root || typeof ResizeObserver === 'undefined')\n            return;\n        const observer = new ResizeObserver(([entry]) => {\n            getTrackAxisX(entry.contentRect.width);\n        });\n        observer.observe(root);\n        return () => {\n            observer.disconnect();\n        };\n    }, [getTrackAxisX, root]);\n    useLayoutEffect(() => {\n        if (!root)\n            return;\n        const { width: rootWidth } = root.getBoundingClientRect();\n        getTrackAxisX(rootWidth);\n    }, [getTrackAxisX, root]);\n    if (!waveformData.length || trackAxisX?.barCount === 0)\n        return null;\n    return (React.createElement(\"div\", { className: 'str-chat__wave-progress-bar__track', \"data-testid\": 'wave-progress-bar-track', onClick: seek, onPointerDown: handleDragStart, onPointerMove: handleDrag, onPointerUp: handleDragStop, ref: setRoot, role: 'progressbar', style: {\n            '--str-chat__voice-recording-amplitude-bar-gap-width': trackAxisX?.gap + 'px',\n        } },\n        resampledWaveformData.map((amplitude, i) => (React.createElement(\"div\", { className: clsx('str-chat__wave-progress-bar__amplitude-bar', {\n                ['str-chat__wave-progress-bar__amplitude-bar--active']: progress > (i / resampledWaveformData.length) * 100,\n            }), \"data-testid\": 'amplitude-bar', key: `amplitude-${i}`, style: {\n                '--str-chat__voice-recording-amplitude-bar-width': trackAxisX?.barWidth + 'px',\n                '--str-chat__wave-progress-bar__amplitude-bar-height': amplitude\n                    ? amplitude * 100 + '%'\n                    : '0%',\n            } }))),\n        React.createElement(\"div\", { className: 'str-chat__wave-progress-bar__progress-indicator', \"data-testid\": 'wave-progress-bar-progress-indicator', ref: setProgressIndicator, style: { left: `${progress < 0 ? 0 : progress > 100 ? 100 : progress}%` } })));\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}