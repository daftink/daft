{"ast":null,"code":"import React, { useCallback, useState } from 'react';\nimport { AttachmentSelector as DefaultAttachmentSelector, SimpleAttachmentSelector } from './AttachmentSelector';\nimport { AttachmentPreviewList as DefaultAttachmentPreviewList } from './AttachmentPreviewList';\nimport { CooldownTimer as DefaultCooldownTimer } from './CooldownTimer';\nimport { SendButton as DefaultSendButton } from './SendButton';\nimport { StopAIGenerationButton as DefaultStopAIGenerationButton } from './StopAIGenerationButton';\nimport { AudioRecorder as DefaultAudioRecorder, RecordingPermissionDeniedNotification as DefaultRecordingPermissionDeniedNotification, StartRecordingAudioButton as DefaultStartRecordingAudioButton, RecordingPermission } from '../MediaRecorder';\nimport { QuotedMessagePreview as DefaultQuotedMessagePreview, QuotedMessagePreviewHeader } from './QuotedMessagePreview';\nimport { LinkPreviewList as DefaultLinkPreviewList } from './LinkPreviewList';\nimport { SendToChannelCheckbox as DefaultSendToChannelCheckbox } from './SendToChannelCheckbox';\nimport { TextareaComposer as DefaultTextareaComposer } from '../TextareaComposer';\nimport { AIStates, useAIState } from '../AIStateIndicator';\nimport { RecordingAttachmentType } from '../MediaRecorder/classes';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useMessageInputContext } from '../../context/MessageInputContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { useAttachmentManagerState } from './hooks/useAttachmentManagerState';\nimport { useMessageContext } from '../../context';\nimport { WithDragAndDropUpload } from './WithDragAndDropUpload';\nexport const MessageInputFlat = () => {\n  const {\n    message\n  } = useMessageContext();\n  const {\n    asyncMessagesMultiSendEnabled,\n    cooldownRemaining,\n    handleSubmit,\n    hideSendButton,\n    recordingController,\n    setCooldownRemaining\n  } = useMessageInputContext('MessageInputFlat');\n  const {\n    AttachmentPreviewList = DefaultAttachmentPreviewList,\n    AttachmentSelector = message ? SimpleAttachmentSelector : DefaultAttachmentSelector,\n    AudioRecorder = DefaultAudioRecorder,\n    CooldownTimer = DefaultCooldownTimer,\n    EmojiPicker,\n    LinkPreviewList = DefaultLinkPreviewList,\n    QuotedMessagePreview = DefaultQuotedMessagePreview,\n    RecordingPermissionDeniedNotification = DefaultRecordingPermissionDeniedNotification,\n    SendButton = DefaultSendButton,\n    SendToChannelCheckbox = DefaultSendToChannelCheckbox,\n    StartRecordingAudioButton = DefaultStartRecordingAudioButton,\n    StopAIGenerationButton: StopAIGenerationButtonOverride,\n    TextareaComposer = DefaultTextareaComposer\n  } = useComponentContext();\n  const {\n    channel\n  } = useChatContext('MessageInputFlat');\n  const {\n    aiState\n  } = useAIState(channel);\n  const stopGenerating = useCallback(() => channel === null || channel === void 0 ? void 0 : channel.stopAIResponse(), [channel]);\n  const [showRecordingPermissionDeniedNotification, setShowRecordingPermissionDeniedNotification] = useState(false);\n  const closePermissionDeniedNotification = useCallback(() => {\n    setShowRecordingPermissionDeniedNotification(false);\n  }, []);\n  const {\n    attachments\n  } = useAttachmentManagerState();\n  if (recordingController.recordingState) return React.createElement(AudioRecorder, null);\n  const recordingEnabled = !!(recordingController.recorder && navigator.mediaDevices); // account for requirement on iOS as per this bug report: https://bugs.webkit.org/show_bug.cgi?id=252303\n  const isRecording = !!recordingController.recordingState;\n  /**\n   * This bit here is needed to make sure that we can get rid of the default behaviour\n   * if need be. Essentially, this allows us to pass StopAIGenerationButton={null} and\n   * completely circumvent the default logic if it's not what we want. We need it as a\n   * prop because there is no other trivial way to override the SendMessage button otherwise.\n   */\n  const StopAIGenerationButton = StopAIGenerationButtonOverride === undefined ? DefaultStopAIGenerationButton : StopAIGenerationButtonOverride;\n  const shouldDisplayStopAIGeneration = [AIStates.Thinking, AIStates.Generating].includes(aiState) && !!StopAIGenerationButton;\n  return React.createElement(WithDragAndDropUpload, {\n    className: 'str-chat__message-input',\n    component: 'div'\n  }, recordingEnabled && recordingController.permissionState === 'denied' && showRecordingPermissionDeniedNotification && React.createElement(RecordingPermissionDeniedNotification, {\n    onClose: closePermissionDeniedNotification,\n    permissionName: RecordingPermission.MIC\n  }), React.createElement(LinkPreviewList, null), React.createElement(QuotedMessagePreviewHeader, null), React.createElement(\"div\", {\n    className: 'str-chat__message-input-inner'\n  }, React.createElement(AttachmentSelector, null), React.createElement(\"div\", {\n    className: 'str-chat__message-textarea-container'\n  }, React.createElement(QuotedMessagePreview, null), React.createElement(AttachmentPreviewList, null), React.createElement(\"div\", {\n    className: 'str-chat__message-textarea-with-emoji-picker'\n  }, React.createElement(TextareaComposer, null), EmojiPicker && React.createElement(EmojiPicker, null))), shouldDisplayStopAIGeneration ? React.createElement(StopAIGenerationButton, {\n    onClick: stopGenerating\n  }) : !hideSendButton && React.createElement(React.Fragment, null, cooldownRemaining ? React.createElement(CooldownTimer, {\n    cooldownInterval: cooldownRemaining,\n    setCooldownRemaining: setCooldownRemaining\n  }) : React.createElement(React.Fragment, null, React.createElement(SendButton, {\n    sendMessage: handleSubmit\n  }), recordingEnabled && React.createElement(StartRecordingAudioButton, {\n    disabled: isRecording || !asyncMessagesMultiSendEnabled && attachments.some(a => a.type === RecordingAttachmentType.VOICE_RECORDING),\n    onClick: () => {\n      var _recordingController$;\n      (_recordingController$ = recordingController.recorder) === null || _recordingController$ === void 0 || _recordingController$.start();\n      setShowRecordingPermissionDeniedNotification(true);\n    }\n  })))), React.createElement(SendToChannelCheckbox, null));\n};","map":{"version":3,"names":["React","useCallback","useState","AttachmentSelector","DefaultAttachmentSelector","SimpleAttachmentSelector","AttachmentPreviewList","DefaultAttachmentPreviewList","CooldownTimer","DefaultCooldownTimer","SendButton","DefaultSendButton","StopAIGenerationButton","DefaultStopAIGenerationButton","AudioRecorder","DefaultAudioRecorder","RecordingPermissionDeniedNotification","DefaultRecordingPermissionDeniedNotification","StartRecordingAudioButton","DefaultStartRecordingAudioButton","RecordingPermission","QuotedMessagePreview","DefaultQuotedMessagePreview","QuotedMessagePreviewHeader","LinkPreviewList","DefaultLinkPreviewList","SendToChannelCheckbox","DefaultSendToChannelCheckbox","TextareaComposer","DefaultTextareaComposer","AIStates","useAIState","RecordingAttachmentType","useChatContext","useMessageInputContext","useComponentContext","useAttachmentManagerState","useMessageContext","WithDragAndDropUpload","MessageInputFlat","message","asyncMessagesMultiSendEnabled","cooldownRemaining","handleSubmit","hideSendButton","recordingController","setCooldownRemaining","EmojiPicker","StopAIGenerationButtonOverride","channel","aiState","stopGenerating","stopAIResponse","showRecordingPermissionDeniedNotification","setShowRecordingPermissionDeniedNotification","closePermissionDeniedNotification","attachments","recordingState","createElement","recordingEnabled","recorder","navigator","mediaDevices","isRecording","undefined","shouldDisplayStopAIGeneration","Thinking","Generating","includes","className","component","permissionState","onClose","permissionName","MIC","onClick","Fragment","cooldownInterval","sendMessage","disabled","some","a","type","VOICE_RECORDING","_recordingController$","start"],"sources":["/tmp/daft-chat-temp/node_modules/stream-chat-react/dist/components/MessageInput/MessageInputFlat.js"],"sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { AttachmentSelector as DefaultAttachmentSelector, SimpleAttachmentSelector, } from './AttachmentSelector';\nimport { AttachmentPreviewList as DefaultAttachmentPreviewList } from './AttachmentPreviewList';\nimport { CooldownTimer as DefaultCooldownTimer } from './CooldownTimer';\nimport { SendButton as DefaultSendButton } from './SendButton';\nimport { StopAIGenerationButton as DefaultStopAIGenerationButton } from './StopAIGenerationButton';\nimport { AudioRecorder as DefaultAudioRecorder, RecordingPermissionDeniedNotification as DefaultRecordingPermissionDeniedNotification, StartRecordingAudioButton as DefaultStartRecordingAudioButton, RecordingPermission, } from '../MediaRecorder';\nimport { QuotedMessagePreview as DefaultQuotedMessagePreview, QuotedMessagePreviewHeader, } from './QuotedMessagePreview';\nimport { LinkPreviewList as DefaultLinkPreviewList } from './LinkPreviewList';\nimport { SendToChannelCheckbox as DefaultSendToChannelCheckbox } from './SendToChannelCheckbox';\nimport { TextareaComposer as DefaultTextareaComposer } from '../TextareaComposer';\nimport { AIStates, useAIState } from '../AIStateIndicator';\nimport { RecordingAttachmentType } from '../MediaRecorder/classes';\nimport { useChatContext } from '../../context/ChatContext';\nimport { useMessageInputContext } from '../../context/MessageInputContext';\nimport { useComponentContext } from '../../context/ComponentContext';\nimport { useAttachmentManagerState } from './hooks/useAttachmentManagerState';\nimport { useMessageContext } from '../../context';\nimport { WithDragAndDropUpload } from './WithDragAndDropUpload';\nexport const MessageInputFlat = () => {\n    const { message } = useMessageContext();\n    const { asyncMessagesMultiSendEnabled, cooldownRemaining, handleSubmit, hideSendButton, recordingController, setCooldownRemaining, } = useMessageInputContext('MessageInputFlat');\n    const { AttachmentPreviewList = DefaultAttachmentPreviewList, AttachmentSelector = message ? SimpleAttachmentSelector : DefaultAttachmentSelector, AudioRecorder = DefaultAudioRecorder, CooldownTimer = DefaultCooldownTimer, EmojiPicker, LinkPreviewList = DefaultLinkPreviewList, QuotedMessagePreview = DefaultQuotedMessagePreview, RecordingPermissionDeniedNotification = DefaultRecordingPermissionDeniedNotification, SendButton = DefaultSendButton, SendToChannelCheckbox = DefaultSendToChannelCheckbox, StartRecordingAudioButton = DefaultStartRecordingAudioButton, StopAIGenerationButton: StopAIGenerationButtonOverride, TextareaComposer = DefaultTextareaComposer, } = useComponentContext();\n    const { channel } = useChatContext('MessageInputFlat');\n    const { aiState } = useAIState(channel);\n    const stopGenerating = useCallback(() => channel?.stopAIResponse(), [channel]);\n    const [showRecordingPermissionDeniedNotification, setShowRecordingPermissionDeniedNotification,] = useState(false);\n    const closePermissionDeniedNotification = useCallback(() => {\n        setShowRecordingPermissionDeniedNotification(false);\n    }, []);\n    const { attachments } = useAttachmentManagerState();\n    if (recordingController.recordingState)\n        return React.createElement(AudioRecorder, null);\n    const recordingEnabled = !!(recordingController.recorder && navigator.mediaDevices); // account for requirement on iOS as per this bug report: https://bugs.webkit.org/show_bug.cgi?id=252303\n    const isRecording = !!recordingController.recordingState;\n    /**\n     * This bit here is needed to make sure that we can get rid of the default behaviour\n     * if need be. Essentially, this allows us to pass StopAIGenerationButton={null} and\n     * completely circumvent the default logic if it's not what we want. We need it as a\n     * prop because there is no other trivial way to override the SendMessage button otherwise.\n     */\n    const StopAIGenerationButton = StopAIGenerationButtonOverride === undefined\n        ? DefaultStopAIGenerationButton\n        : StopAIGenerationButtonOverride;\n    const shouldDisplayStopAIGeneration = [AIStates.Thinking, AIStates.Generating].includes(aiState) &&\n        !!StopAIGenerationButton;\n    return (React.createElement(WithDragAndDropUpload, { className: 'str-chat__message-input', component: 'div' },\n        recordingEnabled &&\n            recordingController.permissionState === 'denied' &&\n            showRecordingPermissionDeniedNotification && (React.createElement(RecordingPermissionDeniedNotification, { onClose: closePermissionDeniedNotification, permissionName: RecordingPermission.MIC })),\n        React.createElement(LinkPreviewList, null),\n        React.createElement(QuotedMessagePreviewHeader, null),\n        React.createElement(\"div\", { className: 'str-chat__message-input-inner' },\n            React.createElement(AttachmentSelector, null),\n            React.createElement(\"div\", { className: 'str-chat__message-textarea-container' },\n                React.createElement(QuotedMessagePreview, null),\n                React.createElement(AttachmentPreviewList, null),\n                React.createElement(\"div\", { className: 'str-chat__message-textarea-with-emoji-picker' },\n                    React.createElement(TextareaComposer, null),\n                    EmojiPicker && React.createElement(EmojiPicker, null))),\n            shouldDisplayStopAIGeneration ? (React.createElement(StopAIGenerationButton, { onClick: stopGenerating })) : (!hideSendButton && (React.createElement(React.Fragment, null, cooldownRemaining ? (React.createElement(CooldownTimer, { cooldownInterval: cooldownRemaining, setCooldownRemaining: setCooldownRemaining })) : (React.createElement(React.Fragment, null,\n                React.createElement(SendButton, { sendMessage: handleSubmit }),\n                recordingEnabled && (React.createElement(StartRecordingAudioButton, { disabled: isRecording ||\n                        (!asyncMessagesMultiSendEnabled &&\n                            attachments.some((a) => a.type === RecordingAttachmentType.VOICE_RECORDING)), onClick: () => {\n                        recordingController.recorder?.start();\n                        setShowRecordingPermissionDeniedNotification(true);\n                    } })))))))),\n        React.createElement(SendToChannelCheckbox, null)));\n};\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,QAAQ,QAAQ,OAAO;AACpD,SAASC,kBAAkB,IAAIC,yBAAyB,EAAEC,wBAAwB,QAAS,sBAAsB;AACjH,SAASC,qBAAqB,IAAIC,4BAA4B,QAAQ,yBAAyB;AAC/F,SAASC,aAAa,IAAIC,oBAAoB,QAAQ,iBAAiB;AACvE,SAASC,UAAU,IAAIC,iBAAiB,QAAQ,cAAc;AAC9D,SAASC,sBAAsB,IAAIC,6BAA6B,QAAQ,0BAA0B;AAClG,SAASC,aAAa,IAAIC,oBAAoB,EAAEC,qCAAqC,IAAIC,4CAA4C,EAAEC,yBAAyB,IAAIC,gCAAgC,EAAEC,mBAAmB,QAAS,kBAAkB;AACpP,SAASC,oBAAoB,IAAIC,2BAA2B,EAAEC,0BAA0B,QAAS,wBAAwB;AACzH,SAASC,eAAe,IAAIC,sBAAsB,QAAQ,mBAAmB;AAC7E,SAASC,qBAAqB,IAAIC,4BAA4B,QAAQ,yBAAyB;AAC/F,SAASC,gBAAgB,IAAIC,uBAAuB,QAAQ,qBAAqB;AACjF,SAASC,QAAQ,EAAEC,UAAU,QAAQ,qBAAqB;AAC1D,SAASC,uBAAuB,QAAQ,0BAA0B;AAClE,SAASC,cAAc,QAAQ,2BAA2B;AAC1D,SAASC,sBAAsB,QAAQ,mCAAmC;AAC1E,SAASC,mBAAmB,QAAQ,gCAAgC;AACpE,SAASC,yBAAyB,QAAQ,mCAAmC;AAC7E,SAASC,iBAAiB,QAAQ,eAAe;AACjD,SAASC,qBAAqB,QAAQ,yBAAyB;AAC/D,OAAO,MAAMC,gBAAgB,GAAGA,CAAA,KAAM;EAClC,MAAM;IAAEC;EAAQ,CAAC,GAAGH,iBAAiB,CAAC,CAAC;EACvC,MAAM;IAAEI,6BAA6B;IAAEC,iBAAiB;IAAEC,YAAY;IAAEC,cAAc;IAAEC,mBAAmB;IAAEC;EAAsB,CAAC,GAAGZ,sBAAsB,CAAC,kBAAkB,CAAC;EACjL,MAAM;IAAE5B,qBAAqB,GAAGC,4BAA4B;IAAEJ,kBAAkB,GAAGqC,OAAO,GAAGnC,wBAAwB,GAAGD,yBAAyB;IAAEU,aAAa,GAAGC,oBAAoB;IAAEP,aAAa,GAAGC,oBAAoB;IAAEsC,WAAW;IAAEvB,eAAe,GAAGC,sBAAsB;IAAEJ,oBAAoB,GAAGC,2BAA2B;IAAEN,qCAAqC,GAAGC,4CAA4C;IAAEP,UAAU,GAAGC,iBAAiB;IAAEe,qBAAqB,GAAGC,4BAA4B;IAAET,yBAAyB,GAAGC,gCAAgC;IAAEP,sBAAsB,EAAEoC,8BAA8B;IAAEpB,gBAAgB,GAAGC;EAAyB,CAAC,GAAGM,mBAAmB,CAAC,CAAC;EACjrB,MAAM;IAAEc;EAAQ,CAAC,GAAGhB,cAAc,CAAC,kBAAkB,CAAC;EACtD,MAAM;IAAEiB;EAAQ,CAAC,GAAGnB,UAAU,CAACkB,OAAO,CAAC;EACvC,MAAME,cAAc,GAAGlD,WAAW,CAAC,MAAMgD,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEG,cAAc,CAAC,CAAC,EAAE,CAACH,OAAO,CAAC,CAAC;EAC9E,MAAM,CAACI,yCAAyC,EAAEC,4CAA4C,CAAE,GAAGpD,QAAQ,CAAC,KAAK,CAAC;EAClH,MAAMqD,iCAAiC,GAAGtD,WAAW,CAAC,MAAM;IACxDqD,4CAA4C,CAAC,KAAK,CAAC;EACvD,CAAC,EAAE,EAAE,CAAC;EACN,MAAM;IAAEE;EAAY,CAAC,GAAGpB,yBAAyB,CAAC,CAAC;EACnD,IAAIS,mBAAmB,CAACY,cAAc,EAClC,OAAOzD,KAAK,CAAC0D,aAAa,CAAC5C,aAAa,EAAE,IAAI,CAAC;EACnD,MAAM6C,gBAAgB,GAAG,CAAC,EAAEd,mBAAmB,CAACe,QAAQ,IAAIC,SAAS,CAACC,YAAY,CAAC,CAAC,CAAC;EACrF,MAAMC,WAAW,GAAG,CAAC,CAAClB,mBAAmB,CAACY,cAAc;EACxD;AACJ;AACA;AACA;AACA;AACA;EACI,MAAM7C,sBAAsB,GAAGoC,8BAA8B,KAAKgB,SAAS,GACrEnD,6BAA6B,GAC7BmC,8BAA8B;EACpC,MAAMiB,6BAA6B,GAAG,CAACnC,QAAQ,CAACoC,QAAQ,EAAEpC,QAAQ,CAACqC,UAAU,CAAC,CAACC,QAAQ,CAAClB,OAAO,CAAC,IAC5F,CAAC,CAACtC,sBAAsB;EAC5B,OAAQZ,KAAK,CAAC0D,aAAa,CAACpB,qBAAqB,EAAE;IAAE+B,SAAS,EAAE,yBAAyB;IAAEC,SAAS,EAAE;EAAM,CAAC,EACzGX,gBAAgB,IACZd,mBAAmB,CAAC0B,eAAe,KAAK,QAAQ,IAChDlB,yCAAyC,IAAKrD,KAAK,CAAC0D,aAAa,CAAC1C,qCAAqC,EAAE;IAAEwD,OAAO,EAAEjB,iCAAiC;IAAEkB,cAAc,EAAErD,mBAAmB,CAACsD;EAAI,CAAC,CAAE,EACtM1E,KAAK,CAAC0D,aAAa,CAAClC,eAAe,EAAE,IAAI,CAAC,EAC1CxB,KAAK,CAAC0D,aAAa,CAACnC,0BAA0B,EAAE,IAAI,CAAC,EACrDvB,KAAK,CAAC0D,aAAa,CAAC,KAAK,EAAE;IAAEW,SAAS,EAAE;EAAgC,CAAC,EACrErE,KAAK,CAAC0D,aAAa,CAACvD,kBAAkB,EAAE,IAAI,CAAC,EAC7CH,KAAK,CAAC0D,aAAa,CAAC,KAAK,EAAE;IAAEW,SAAS,EAAE;EAAuC,CAAC,EAC5ErE,KAAK,CAAC0D,aAAa,CAACrC,oBAAoB,EAAE,IAAI,CAAC,EAC/CrB,KAAK,CAAC0D,aAAa,CAACpD,qBAAqB,EAAE,IAAI,CAAC,EAChDN,KAAK,CAAC0D,aAAa,CAAC,KAAK,EAAE;IAAEW,SAAS,EAAE;EAA+C,CAAC,EACpFrE,KAAK,CAAC0D,aAAa,CAAC9B,gBAAgB,EAAE,IAAI,CAAC,EAC3CmB,WAAW,IAAI/C,KAAK,CAAC0D,aAAa,CAACX,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,EAC/DkB,6BAA6B,GAAIjE,KAAK,CAAC0D,aAAa,CAAC9C,sBAAsB,EAAE;IAAE+D,OAAO,EAAExB;EAAe,CAAC,CAAC,GAAK,CAACP,cAAc,IAAK5C,KAAK,CAAC0D,aAAa,CAAC1D,KAAK,CAAC4E,QAAQ,EAAE,IAAI,EAAElC,iBAAiB,GAAI1C,KAAK,CAAC0D,aAAa,CAAClD,aAAa,EAAE;IAAEqE,gBAAgB,EAAEnC,iBAAiB;IAAEI,oBAAoB,EAAEA;EAAqB,CAAC,CAAC,GAAK9C,KAAK,CAAC0D,aAAa,CAAC1D,KAAK,CAAC4E,QAAQ,EAAE,IAAI,EACjW5E,KAAK,CAAC0D,aAAa,CAAChD,UAAU,EAAE;IAAEoE,WAAW,EAAEnC;EAAa,CAAC,CAAC,EAC9DgB,gBAAgB,IAAK3D,KAAK,CAAC0D,aAAa,CAACxC,yBAAyB,EAAE;IAAE6D,QAAQ,EAAEhB,WAAW,IAClF,CAACtB,6BAA6B,IAC3Be,WAAW,CAACwB,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,KAAKlD,uBAAuB,CAACmD,eAAe,CAAE;IAAER,OAAO,EAAEA,CAAA,KAAM;MAAA,IAAAS,qBAAA;MACjG,CAAAA,qBAAA,GAAAvC,mBAAmB,CAACe,QAAQ,cAAAwB,qBAAA,eAA5BA,qBAAA,CAA8BC,KAAK,CAAC,CAAC;MACrC/B,4CAA4C,CAAC,IAAI,CAAC;IACtD;EAAE,CAAC,CAAE,CAAE,CAAG,CAAC,EACvBtD,KAAK,CAAC0D,aAAa,CAAChC,qBAAqB,EAAE,IAAI,CAAC,CAAC;AACzD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}