{"ast":null,"code":"import React, { useEffect, useState } from 'react';\nimport clsx from 'clsx';\nimport { ArrowDown } from './icons';\nimport { useChannelStateContext, useChatContext } from '../../context';\nconst UnMemoizedScrollToBottomButton = props => {\n  const {\n    isMessageListScrolledToBottom,\n    onClick,\n    threadList\n  } = props;\n  const {\n    channel: activeChannel,\n    client\n  } = useChatContext();\n  const {\n    thread\n  } = useChannelStateContext();\n  const [countUnread, setCountUnread] = useState((activeChannel === null || activeChannel === void 0 ? void 0 : activeChannel.countUnread()) || 0);\n  const [replyCount, setReplyCount] = useState((thread === null || thread === void 0 ? void 0 : thread.reply_count) || 0);\n  const observedEvent = threadList ? 'message.updated' : 'message.new';\n  useEffect(() => {\n    const handleEvent = event => {\n      var _event$user, _client$user, _event$message, _event$message2;\n      const newMessageInAnotherChannel = event.cid !== (activeChannel === null || activeChannel === void 0 ? void 0 : activeChannel.cid);\n      const newMessageIsMine = ((_event$user = event.user) === null || _event$user === void 0 ? void 0 : _event$user.id) === ((_client$user = client.user) === null || _client$user === void 0 ? void 0 : _client$user.id);\n      const isThreadOpen = !!thread;\n      const newMessageIsReply = !!((_event$message = event.message) !== null && _event$message !== void 0 && _event$message.parent_id);\n      const dontIncreaseMainListCounterOnNewReply = isThreadOpen && !threadList && newMessageIsReply;\n      if (isMessageListScrolledToBottom || newMessageInAnotherChannel || newMessageIsMine || dontIncreaseMainListCounterOnNewReply) {\n        return;\n      }\n      if (event.type === 'message.new') {\n        // cannot rely on channel.countUnread because active channel is automatically marked read\n        setCountUnread(prev => prev + 1);\n      } else if (((_event$message2 = event.message) === null || _event$message2 === void 0 ? void 0 : _event$message2.id) === (thread === null || thread === void 0 ? void 0 : thread.id)) {\n        var _event$message3;\n        const newReplyCount = ((_event$message3 = event.message) === null || _event$message3 === void 0 ? void 0 : _event$message3.reply_count) || 0;\n        setCountUnread(() => newReplyCount - replyCount);\n      }\n    };\n    client.on(observedEvent, handleEvent);\n    return () => {\n      client.off(observedEvent, handleEvent);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [activeChannel, isMessageListScrolledToBottom, observedEvent, replyCount, thread]);\n  useEffect(() => {\n    if (isMessageListScrolledToBottom) {\n      setCountUnread(0);\n      setReplyCount((thread === null || thread === void 0 ? void 0 : thread.reply_count) || 0);\n    }\n  }, [isMessageListScrolledToBottom, thread]);\n  if (isMessageListScrolledToBottom) return null;\n  return React.createElement(\"div\", {\n    className: 'str-chat__jump-to-latest-message'\n  }, React.createElement(\"button\", {\n    \"aria-live\": 'polite',\n    className: \"\\n        str-chat__message-notification-scroll-to-latest\\n        str-chat__circle-fab\\n      \",\n    \"data-testid\": 'message-notification',\n    onClick: onClick\n  }, React.createElement(ArrowDown, null), countUnread > 0 && React.createElement(\"div\", {\n    className: clsx('str-chat__message-notification', 'str-chat__jump-to-latest-unread-count'),\n    \"data-testid\": 'unread-message-notification-counter'\n  }, countUnread)));\n};\nexport const ScrollToBottomButton = React.memo(UnMemoizedScrollToBottomButton);","map":{"version":3,"names":["React","useEffect","useState","clsx","ArrowDown","useChannelStateContext","useChatContext","UnMemoizedScrollToBottomButton","props","isMessageListScrolledToBottom","onClick","threadList","channel","activeChannel","client","thread","countUnread","setCountUnread","replyCount","setReplyCount","reply_count","observedEvent","handleEvent","event","_event$user","_client$user","_event$message","_event$message2","newMessageInAnotherChannel","cid","newMessageIsMine","user","id","isThreadOpen","newMessageIsReply","message","parent_id","dontIncreaseMainListCounterOnNewReply","type","prev","_event$message3","newReplyCount","on","off","createElement","className","ScrollToBottomButton","memo"],"sources":["/tmp/daft-chat-temp/node_modules/stream-chat-react/dist/components/MessageList/ScrollToBottomButton.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport clsx from 'clsx';\nimport { ArrowDown } from './icons';\nimport { useChannelStateContext, useChatContext } from '../../context';\nconst UnMemoizedScrollToBottomButton = (props) => {\n    const { isMessageListScrolledToBottom, onClick, threadList } = props;\n    const { channel: activeChannel, client } = useChatContext();\n    const { thread } = useChannelStateContext();\n    const [countUnread, setCountUnread] = useState(activeChannel?.countUnread() || 0);\n    const [replyCount, setReplyCount] = useState(thread?.reply_count || 0);\n    const observedEvent = threadList ? 'message.updated' : 'message.new';\n    useEffect(() => {\n        const handleEvent = (event) => {\n            const newMessageInAnotherChannel = event.cid !== activeChannel?.cid;\n            const newMessageIsMine = event.user?.id === client.user?.id;\n            const isThreadOpen = !!thread;\n            const newMessageIsReply = !!event.message?.parent_id;\n            const dontIncreaseMainListCounterOnNewReply = isThreadOpen && !threadList && newMessageIsReply;\n            if (isMessageListScrolledToBottom ||\n                newMessageInAnotherChannel ||\n                newMessageIsMine ||\n                dontIncreaseMainListCounterOnNewReply) {\n                return;\n            }\n            if (event.type === 'message.new') {\n                // cannot rely on channel.countUnread because active channel is automatically marked read\n                setCountUnread((prev) => prev + 1);\n            }\n            else if (event.message?.id === thread?.id) {\n                const newReplyCount = event.message?.reply_count || 0;\n                setCountUnread(() => newReplyCount - replyCount);\n            }\n        };\n        client.on(observedEvent, handleEvent);\n        return () => {\n            client.off(observedEvent, handleEvent);\n        };\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [activeChannel, isMessageListScrolledToBottom, observedEvent, replyCount, thread]);\n    useEffect(() => {\n        if (isMessageListScrolledToBottom) {\n            setCountUnread(0);\n            setReplyCount(thread?.reply_count || 0);\n        }\n    }, [isMessageListScrolledToBottom, thread]);\n    if (isMessageListScrolledToBottom)\n        return null;\n    return (React.createElement(\"div\", { className: 'str-chat__jump-to-latest-message' },\n        React.createElement(\"button\", { \"aria-live\": 'polite', className: `\n        str-chat__message-notification-scroll-to-latest\n        str-chat__circle-fab\n      `, \"data-testid\": 'message-notification', onClick: onClick },\n            React.createElement(ArrowDown, null),\n            countUnread > 0 && (React.createElement(\"div\", { className: clsx('str-chat__message-notification', 'str-chat__jump-to-latest-unread-count'), \"data-testid\": 'unread-message-notification-counter' }, countUnread)))));\n};\nexport const ScrollToBottomButton = React.memo(UnMemoizedScrollToBottomButton);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}