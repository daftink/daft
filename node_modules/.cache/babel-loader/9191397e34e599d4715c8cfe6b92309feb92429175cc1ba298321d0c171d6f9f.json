{"ast":null,"code":"import _objectSpread from \"/tmp/daft-chat-temp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport uniqBy from 'lodash.uniqby';\nimport { useCallback, useEffect, useMemo } from 'react';\nimport { StateStore } from 'stream-chat';\nexport const useCursorPaginator = (paginationFn, loadFirstPage) => {\n  const cursorPaginatorState = useMemo(() => new StateStore({\n    hasNextPage: true,\n    items: [],\n    latestPageItems: [],\n    loading: false\n  }), []);\n  const loadMore = useCallback(async () => {\n    const {\n      loading,\n      next: currentNext\n    } = cursorPaginatorState.getLatestValue();\n    if (currentNext === null || loading) return;\n    cursorPaginatorState.partialNext({\n      loading: true\n    });\n    try {\n      const {\n        items,\n        next\n      } = await paginationFn(currentNext);\n      cursorPaginatorState.next(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        hasNextPage: !!next,\n        items: uniqBy(prev.items.concat(items), 'id'),\n        latestPageItems: items,\n        next: next || null\n      }));\n    } catch (error) {\n      cursorPaginatorState.partialNext({\n        error: error\n      });\n    }\n    cursorPaginatorState.partialNext({\n      loading: false\n    });\n  }, [cursorPaginatorState, paginationFn]);\n  useEffect(() => {\n    const {\n      items\n    } = cursorPaginatorState.getLatestValue();\n    if (!loadFirstPage || items.length) return;\n    loadMore();\n  }, [cursorPaginatorState, loadFirstPage, loadMore]);\n  return {\n    cursorPaginatorState,\n    loadMore\n  };\n};","map":{"version":3,"names":["uniqBy","useCallback","useEffect","useMemo","StateStore","useCursorPaginator","paginationFn","loadFirstPage","cursorPaginatorState","hasNextPage","items","latestPageItems","loading","loadMore","next","currentNext","getLatestValue","partialNext","prev","_objectSpread","concat","error","length"],"sources":["/tmp/daft-chat-temp/node_modules/stream-chat-react/dist/components/InfiniteScrollPaginator/hooks/useCursorPaginator.js"],"sourcesContent":["import uniqBy from 'lodash.uniqby';\nimport { useCallback, useEffect, useMemo } from 'react';\nimport { StateStore } from 'stream-chat';\nexport const useCursorPaginator = (paginationFn, loadFirstPage) => {\n    const cursorPaginatorState = useMemo(() => new StateStore({\n        hasNextPage: true,\n        items: [],\n        latestPageItems: [],\n        loading: false,\n    }), []);\n    const loadMore = useCallback(async () => {\n        const { loading, next: currentNext } = cursorPaginatorState.getLatestValue();\n        if (currentNext === null || loading)\n            return;\n        cursorPaginatorState.partialNext({ loading: true });\n        try {\n            const { items, next } = await paginationFn(currentNext);\n            cursorPaginatorState.next((prev) => ({\n                ...prev,\n                hasNextPage: !!next,\n                items: uniqBy(prev.items.concat(items), 'id'),\n                latestPageItems: items,\n                next: next || null,\n            }));\n        }\n        catch (error) {\n            cursorPaginatorState.partialNext({ error: error });\n        }\n        cursorPaginatorState.partialNext({ loading: false });\n    }, [cursorPaginatorState, paginationFn]);\n    useEffect(() => {\n        const { items } = cursorPaginatorState.getLatestValue();\n        if (!loadFirstPage || items.length)\n            return;\n        loadMore();\n    }, [cursorPaginatorState, loadFirstPage, loadMore]);\n    return {\n        cursorPaginatorState,\n        loadMore,\n    };\n};\n"],"mappings":";AAAA,OAAOA,MAAM,MAAM,eAAe;AAClC,SAASC,WAAW,EAAEC,SAAS,EAAEC,OAAO,QAAQ,OAAO;AACvD,SAASC,UAAU,QAAQ,aAAa;AACxC,OAAO,MAAMC,kBAAkB,GAAGA,CAACC,YAAY,EAAEC,aAAa,KAAK;EAC/D,MAAMC,oBAAoB,GAAGL,OAAO,CAAC,MAAM,IAAIC,UAAU,CAAC;IACtDK,WAAW,EAAE,IAAI;IACjBC,KAAK,EAAE,EAAE;IACTC,eAAe,EAAE,EAAE;IACnBC,OAAO,EAAE;EACb,CAAC,CAAC,EAAE,EAAE,CAAC;EACP,MAAMC,QAAQ,GAAGZ,WAAW,CAAC,YAAY;IACrC,MAAM;MAAEW,OAAO;MAAEE,IAAI,EAAEC;IAAY,CAAC,GAAGP,oBAAoB,CAACQ,cAAc,CAAC,CAAC;IAC5E,IAAID,WAAW,KAAK,IAAI,IAAIH,OAAO,EAC/B;IACJJ,oBAAoB,CAACS,WAAW,CAAC;MAAEL,OAAO,EAAE;IAAK,CAAC,CAAC;IACnD,IAAI;MACA,MAAM;QAAEF,KAAK;QAAEI;MAAK,CAAC,GAAG,MAAMR,YAAY,CAACS,WAAW,CAAC;MACvDP,oBAAoB,CAACM,IAAI,CAAEI,IAAI,IAAAC,aAAA,CAAAA,aAAA,KACxBD,IAAI;QACPT,WAAW,EAAE,CAAC,CAACK,IAAI;QACnBJ,KAAK,EAAEV,MAAM,CAACkB,IAAI,CAACR,KAAK,CAACU,MAAM,CAACV,KAAK,CAAC,EAAE,IAAI,CAAC;QAC7CC,eAAe,EAAED,KAAK;QACtBI,IAAI,EAAEA,IAAI,IAAI;MAAI,EACpB,CAAC;IACP,CAAC,CACD,OAAOO,KAAK,EAAE;MACVb,oBAAoB,CAACS,WAAW,CAAC;QAAEI,KAAK,EAAEA;MAAM,CAAC,CAAC;IACtD;IACAb,oBAAoB,CAACS,WAAW,CAAC;MAAEL,OAAO,EAAE;IAAM,CAAC,CAAC;EACxD,CAAC,EAAE,CAACJ,oBAAoB,EAAEF,YAAY,CAAC,CAAC;EACxCJ,SAAS,CAAC,MAAM;IACZ,MAAM;MAAEQ;IAAM,CAAC,GAAGF,oBAAoB,CAACQ,cAAc,CAAC,CAAC;IACvD,IAAI,CAACT,aAAa,IAAIG,KAAK,CAACY,MAAM,EAC9B;IACJT,QAAQ,CAAC,CAAC;EACd,CAAC,EAAE,CAACL,oBAAoB,EAAED,aAAa,EAAEM,QAAQ,CAAC,CAAC;EACnD,OAAO;IACHL,oBAAoB;IACpBK;EACJ,CAAC;AACL,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}